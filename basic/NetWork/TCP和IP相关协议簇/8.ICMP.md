# ICMP 报文控制协议

IP协议是尽力而为的传输方式，本身不提供直接的方法来检测那些发送失败的数据报。为了解决这些不足，将一个特殊的Internet控制报文（ICMP）和IP协议配合使用。

ICMP通常认为是IP层的一部分，它需要在所有IP实现中存在。它使用IP协议进行传输。但实际上，确切的说，它是一个位于网络层和传输层之间的协议。不单独属于任何一方。

ICMP并不为IP网络提供可靠性，也就是说，它只是说明了某些可能出错的原因和故障。最常见的丢包（接受方缓冲区满）并不会触发任何的ICMP报文，这其实是由TCP实现的。

介于ICMP能够影响重要的系统功能和配置信息。通常会禁用ICMP报文，如果ICMP被封锁，ping和traceroute就无法使用。

# 8.1 ICMP在IPV4的封装

ICMP报文是在IP报文数据报内传输的。

在IPV4中，Protocal字段值为1就表明携带了ICMP报文。IPV4头部之后，会有一个4字节的ICMP头部，以及ICMP数据报。ICMP头部都是以8位类型和8位代码字段开始，再加上16位的检验和。

# 8.2 ICMP报文

ICMP报文可以分为两大类，一个是有关数据报传递的差错报文，另外一个是有关信息采集和配置信息的查询报文。

### 8.2.1 IPV4 ICMP报文

对于ICMP IPV4，信息类报文有：

* 回显请求：类型8

* 回显应答：类型0

* 路由器通告：类型9

* 路由器请求：类型10

差错控制报文有：

* 目的不可达：类型3

* 重定向：类型5

* 超时：类型11

* 参数问题：类型12

# 8.3 ICMP超时

每一个IPV4分组都有一个TTL标志，当经过一定次数的跳转后，TTL变为0，这时候就会产生ICMP超时报文。