# 设计和实现

# 1.分层

通过分层，每层只负责通信的一个方面。采用分层有利用不同层级的结构由不同领域的人进行处理，常见的有OSI模型和TCP/IP模型。

每层都有各自的任务，自下而上：

* 物理层定义了通信介质传输数字信息的方法，以太网和无线局域网的一部分实现也在物理层

* 数据链路层包含为共享相同介质的邻居建立连接的协议和方法，也包括差错检测和链路层地址格式

* 网络层主要描述了网络分组的格式和结构

* 传输层指定运行在相同计算机系统中的多个程序之间连接和取消的方法

* 会话层表示运行中的应用之间的交互

* 表示层对应用的数据表示格式和编码规则的方法进行了控制

* 应用层通常由开发者设计和实现，各种应用程序通常实现自己的应用层协议

### 1.1 分层实现中的复用，分解和封装

不同协议实现在不同层级，可以实现协议的复用。

另外，对于获得上层数据的某层来说，它承诺不查看协议数据单元（PDU）中的具体内容，这是封装的本质。往往通过在头部或者尾部增加识别单元标注一些重要的状态信息。

# 2.TCP协议簇

TCP分层采用四层结构。自下而上，分别有链路层，网络层，传输层和应用层。

链路层用来处理网络层到物理层的地址映射关系，最著名的就是ARP协议。

网络层发给链路层的PDU称为IP数据报，IPV4中大小为64K，IPV6扩充为4GB。通常，这个PDU简称为分组。大的分组放入链路层PDU（帧）时需要缩小处理，这个过程称为分片，通常由IP主机和某些路由器进行执行，在到达目的地后进行重组。

由于每个分组都是一个数据报，所以都包含发送方和目的地的IP地址。每个数据报的目的地址用来决定发送到哪里，做出此决定的过程称为转发。路由器和主机都能执行转发。转发通常有三种方式：

* 单播：发送给指定网络的一台主机

* 广播：发送给指定网络的所有主机

* 组播：发送给指定网络的一组主机

ICMP（报文控制协议）是网络层的一个辅助协议，用来与其他主机交换差错信息和其他重要信息。ping和traceroute指令都是用了ICMP。

传输层采用tcp和udp两种传输方式，tcp会处理数据报丢失，重复和重新排序等问题。udp不强制实现差错控制。

# 3.端口号

端口号是16位的非负整数。每个IP地址都有65536个对应端口号，每个传输协议使用这些端口号保证正确接收数据。

通常，0-1023位熟知端口号，用来识别很多众所周知的服务。比如，FTP（20和21），电子邮件（25），DNS（53），HTTP和HTTPS(80和443)。

# 4.域名

每个主机或者路由器至少有一个IP地址，这些IP地址不容易记忆，因此常常采用域名代替。这就需要DNS（域名解析协议）。



