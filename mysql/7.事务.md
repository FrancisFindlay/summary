# 事务

# 7.1 什么是事务
  一系列要么全做要么全不做的操作就是事务。
  
# 7.2 ACID

  * 原子性：整个数据库事务是不可分割的工作单位。
  
  * 一致性：数据库从一种状态转为另外一种状态，数据库的完整性约束没有被破坏。
  
  * 持久性：事务一旦提交，结果是永久的，就算数据库崩溃，也可以恢复数据。
  
  * 隔离性：事务提交前对其他事务不可见，不同事务互相隔离。
 
# 7.3 事务的实现
  原子性和持久性通过redo log来保证，一致性通过undo log来保证。
  
  * redo log：重做日志，恢复事务提交的操作
  
  * undo log：回退到某个特定版本
  
  * binlog：复制数据库或者恢复数据
  
  redo log 存储的是物理数据的变更，如果我们内存的数据已经刷到了磁盘了，那redo log的数据就无效了。所以redo log不会存储着历史所有数据的变更，文件的内容会被覆盖的。
  
# 7.4 redo
  redo由两部分组成，一个是重做日志缓冲，另外一个是重做日志文件。
  
  MySQL更新完内存，会写一份redo log,记载操作。    
  
  
# 7.5 两段锁协议

两段锁协议规定所有的事务应遵守的规则：

① 在对任何数据进行读、写操作之前，首先要申请并获得对该数据的封锁。

② 在释放一个封锁之后，事务不再申请和获得其它任何封锁。

即事务的执行分为两个阶段：

第一阶段是获得封锁的阶段，称为扩展阶段。

第二阶段是释放封锁的阶段，称为收缩阶段。

若所有事务均遵守两段锁协议，则这些事务的所有交叉调度都是可串行化的。

